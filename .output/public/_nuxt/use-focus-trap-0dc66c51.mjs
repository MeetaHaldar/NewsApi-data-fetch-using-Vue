import{o as H}from"./keyboard-b81851fc.mjs";import{F as c,H as b,p as w,L as y}from"./focus-management-c0b49fb2.mjs";import{e as M}from"./owner-f2792c55.mjs";import{r as g}from"./use-event-listener-442b8502.mjs";import{t as N}from"./dom-0d1fce75.mjs";import{h as k,m as R,w as E,i as L}from"./entry-fba3770b.mjs";var B=(e=>(e[e.None=1]="None",e[e.InitialFocus=2]="InitialFocus",e[e.TabLock=4]="TabLock",e[e.FocusLock=8]="FocusLock",e[e.RestoreFocus=16]="RestoreFocus",e[e.All=30]="All",e))(B||{});function K(e,v=k(30),t=k({})){var m,T;let r=k(null),n=k(null),f={value:!1},d=L(()=>Boolean(v.value&16)),h=L(()=>Boolean(v.value&2)),i=L(()=>M(e));return R(()=>{E(d,(l,a)=>{var u;l!==a&&(!d.value||(f.value=!0,r.value||(r.value=(u=i.value)==null?void 0:u.activeElement)))},{immediate:!0}),E(d,(l,a,u)=>{l!==a&&(!d.value||u(()=>{f.value!==!1&&(f.value=!1,c(r.value),r.value=null)}))},{immediate:!0}),E([e,t,t.value.initialFocus,h],(l,a)=>{var u,s;if(l.every((x,A)=>(a==null?void 0:a[A])===x)||!h.value)return;let o=e.value;if(!o)return;let p=N(t.value.initialFocus),F=(u=i.value)==null?void 0:u.activeElement;if(p){if(p===F){n.value=F;return}}else if(o.contains(F)){n.value=F;return}p?c(p):b(o,w.First)===y.Error&&console.warn("There are no focusable elements inside the <FocusTrap />"),n.value=(s=i.value)==null?void 0:s.activeElement},{immediate:!0})}),g((m=i.value)==null?void 0:m.defaultView,"keydown",l=>{var a;!(v.value&4)||!e.value||l.key===H.Tab&&(l.preventDefault(),b(e.value,(l.shiftKey?w.Previous:w.Next)|w.WrapAround)===y.Success&&(n.value=(a=i.value)==null?void 0:a.activeElement))}),g((T=i.value)==null?void 0:T.defaultView,"focus",l=>{var a;if(!(v.value&8))return;let u=new Set((a=t.value.containers)==null?void 0:a.value);if(u.add(e),!u.size)return;let s=n.value;if(!s||!f.value)return;let o=l.target;o&&o instanceof HTMLElement?D(u,o)?(n.value=o,c(o)):(l.preventDefault(),l.stopPropagation(),c(s)):c(n.value)},!0),r}function D(e,v){var t;for(let m of e)if((t=m.value)!=null&&t.contains(v))return!0;return!1}export{K as W,B as g};
